# Dify è·å–ä¼šè¯å†å²æ¶ˆæ¯ API æ–‡æ¡£

## æ¦‚è¿°

è¯¥æ¥å£ç”¨äºè·å–æŒ‡å®šä¼šè¯ä¸­çš„å†å²èŠå¤©è®°å½•ï¼Œé‡‡ç”¨**æ»šåŠ¨åŠ è½½ï¼ˆå€’åºï¼‰**æ–¹å¼è¿”å›ï¼šç¬¬ä¸€é¡µè¿”å›æœ€æ–°çš„ `limit` æ¡æ¶ˆæ¯ï¼Œåç»­é¡µé€šè¿‡ `first_id` å®ç°å‘ä¸Šç¿»é¡µã€‚

---

## è¯·æ±‚ä¿¡æ¯

- **æ–¹æ³•**ï¼š`GET`
- **è·¯å¾„**ï¼š`/v1/messages`
- **è®¤è¯**ï¼šéœ€åœ¨ Header ä¸­æä¾› `Authorization: Bearer {api_key}`

### è¯·æ±‚ç¤ºä¾‹ï¼ˆcURLï¼‰

```bash
curl -X GET 'https://api.dify.ai/v1/messages?user=abc-123&conversation_id={conversation_id}' \
  --header 'Authorization: Bearer {api_key}'
```

---

## æŸ¥è¯¢å‚æ•°ï¼ˆQuery Parametersï¼‰

| å‚æ•°å | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | æè¿° |
|--------|------|------|--------|------|
| `conversation_id` | `string` | âœ… | â€” | ç›®æ ‡ä¼šè¯çš„å”¯ä¸€ ID |
| `user` | `string` | âœ… | â€” | ç”¨æˆ·å”¯ä¸€æ ‡è¯†ï¼Œç”±å¼€å‘è€…å®šä¹‰ï¼Œéœ€åœ¨åº”ç”¨å†…ä¿è¯å”¯ä¸€æ€§ |
| `first_id` | `string` | âŒ | `null` | å½“å‰é¡µ**ç¬¬ä¸€æ¡**æ¶ˆæ¯çš„ IDï¼Œç”¨äºåŠ è½½æ›´æ—©çš„å†å²è®°å½•ï¼ˆå³ä¸Šä¸€é¡µï¼‰ |
| `limit` | `int` | âŒ | `20` | æ¯æ¬¡è¯·æ±‚è¿”å›çš„æ¶ˆæ¯æ•°é‡ï¼Œå»ºè®®èŒƒå›´ï¼š1â€“100 |

> ğŸ’¡ **åˆ†é¡µé€»è¾‘è¯´æ˜**ï¼š  
> - é¦–æ¬¡è¯·æ±‚ä¸ä¼  `first_id`ï¼Œè¿”å›æœ€æ–° `limit` æ¡æ¶ˆæ¯ï¼ˆæŒ‰æ—¶é—´å€’åºï¼‰ã€‚  
> - è‹¥ `has_more: true`ï¼Œå°†å½“å‰é¡µ**ç¬¬ä¸€æ¡**æ¶ˆæ¯çš„ `id` ä½œä¸ºä¸‹ä¸€æ¬¡è¯·æ±‚çš„ `first_id`ï¼Œä»¥è·å–æ›´æ—©çš„æ¶ˆæ¯ã€‚

---

## å“åº”ï¼ˆResponseï¼‰

- **Content-Type**: `application/json`

### å“åº”ç»“æ„

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `limit` | `int` | å®é™…è¿”å›çš„æ¶ˆæ¯æ¡æ•°ï¼ˆå¯èƒ½å—ç³»ç»Ÿé™åˆ¶ï¼‰ |
| `has_more` | `bool` | æ˜¯å¦è¿˜æœ‰æ›´æ—©çš„æ¶ˆæ¯å¯ä¾›åŠ è½½ |
| `data` | `array[object]` | æ¶ˆæ¯åˆ—è¡¨ï¼ˆæŒ‰æ—¶é—´**å€’åº**æ’åˆ—ï¼Œæœ€æ–°åœ¨å‰ï¼‰ |

### `data` æ•°ç»„é¡¹ç»“æ„

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `id` | `string` | æ¶ˆæ¯å”¯ä¸€ ID |
| `conversation_id` | `string` | æ‰€å±ä¼šè¯ ID |
| `inputs` | `object` | ç”¨æˆ·åœ¨è¯¥è½®å¯¹è¯ä¸­ä¼ å…¥çš„å˜é‡ï¼ˆé”®å€¼å¯¹ï¼‰ |
| `query` | `string` | ç”¨æˆ·è¾“å…¥/æé—®å†…å®¹ |
| `answer` | `string` | åŠ©æ‰‹å›å¤å†…å®¹ |
| `message_files` | `array[object]` | æœ¬è½®æ¶ˆæ¯å…³è”çš„æ–‡ä»¶åˆ—è¡¨ï¼ˆå¦‚ç”¨æˆ·ä¸Šä¼ æˆ–æ¨¡å‹ç”Ÿæˆçš„å›¾ç‰‡ï¼‰ |
| `feedback` | `object \| null` | ç”¨æˆ·åé¦ˆä¿¡æ¯ |
| `retriever_resources` | `array[RetrieverResource]` | å¼•ç”¨çš„çŸ¥è¯†åº“ç‰‡æ®µï¼ˆå¦‚æœ‰ï¼‰ |
| `created_at` | `timestamp` (int) | æ¶ˆæ¯åˆ›å»ºæ—¶é—´ï¼ˆUnix ç§’æ—¶é—´æˆ³ï¼‰ |

#### `message_files` é¡¹ç»“æ„

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `id` | `string` | æ–‡ä»¶å”¯ä¸€ ID |
| `type` | `string` | æ–‡ä»¶ç±»å‹ï¼ˆç›®å‰ä¸»è¦ä¸º `"image"`ï¼‰ |
| `url` | `string` | æ–‡ä»¶é¢„è§ˆåœ°å€ï¼Œå¯é€šè¿‡ `/files/{file_id}/preview` æ¥å£è®¿é—® |
| `belongs_to` | `string` | æ–‡ä»¶å½’å±æ–¹ï¼š`"user"` æˆ– `"assistant"` |

#### `feedback` ç»“æ„ï¼ˆè‹¥å­˜åœ¨ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `rating` | `string` | ç”¨æˆ·åé¦ˆï¼š<br>â€¢ `"like"` è¡¨ç¤ºç‚¹èµ<br>â€¢ `"dislike"` è¡¨ç¤ºç‚¹è¸© |

#### `retriever_resources` é¡¹ç»“æ„ï¼ˆåŒå…¶ä»–æ¥å£ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `position` | `int` | å¼•ç”¨é¡ºåº |
| `dataset_id` / `dataset_name` | `string` | æ•°æ®é›†ä¿¡æ¯ |
| `document_id` / `document_name` | `string` | æ–‡æ¡£ä¿¡æ¯ |
| `segment_id` | `string` | ç‰‡æ®µ ID |
| `score` | `float` | ç›¸ä¼¼åº¦å¾—åˆ† |
| `content` | `string` | åŸå§‹æ–‡æœ¬å†…å®¹ |

---

## å“åº”ç¤ºä¾‹

```json
{
  "limit": 20,
  "has_more": false,
  "data": [
    {
      "id": "a076a87f-31e5-48dc-b452-0061adbbc922",
      "conversation_id": "cd78daf6-f9e4-4463-9ff2-54257230a0ce",
      "inputs": {
        "name": "dify"
      },
      "query": "iphone 13 pro",
      "answer": "The iPhone 13 Pro, released on September 24, 2021, features a 6.1-inch display with a resolution of 1170 x 2532...",
      "message_files": [],
      "feedback": null,
      "retriever_resources": [
        {
          "position": 1,
          "dataset_id": "101b4c97-fc2e-463c-90b1-5261a4cdcafb",
          "dataset_name": "iPhone",
          "document_id": "8dd1ad74-0b5f-4175-b735-7d98bbbb4e00",
          "document_name": "iPhone List",
          "segment_id": "ed599c7f-2766-4294-9d1d-e5235a61270a",
          "score": 0.98457545,
          "content": "\"Model\",\"Release Date\",...\"iOS 15\""
        }
      ],
      "created_at": 1705569239
    }
  ]
}
```

---

## ä½¿ç”¨å»ºè®®

- **é¦–æ¬¡åŠ è½½**ï¼šä¸ä¼  `first_id`ï¼Œè·å–æœ€æ–°å¯¹è¯ã€‚
- **å‘ä¸Šç¿»é¡µ**ï¼šä½¿ç”¨å½“å‰é¡µ**ç¬¬ä¸€æ¡**æ¶ˆæ¯çš„ `id` ä½œä¸º `first_id` è¯·æ±‚æ›´æ—©è®°å½•ã€‚
- **æ–‡ä»¶å¤„ç†**ï¼šè‹¥ `message_files` éç©ºï¼Œå¯é€šè¿‡ `url` å­—æ®µæˆ– Dify çš„æ–‡ä»¶é¢„è§ˆæ¥å£å®‰å…¨åŠ è½½æ–‡ä»¶ã€‚
- **åé¦ˆå±•ç¤º**ï¼šå¯æ ¹æ® `feedback.rating` åœ¨ UI ä¸­é«˜äº®ç”¨æˆ·è¯„ä»·ã€‚

> ğŸ“Œ æ³¨æ„ï¼šæ¶ˆæ¯æŒ‰**åˆ›å»ºæ—¶é—´å€’åº**è¿”å›ï¼ˆæœ€æ–°åœ¨å‰ï¼‰ï¼Œé€‚åˆä»åº•éƒ¨å‘ä¸Šæ»šåŠ¨åŠ è½½å†å²è®°å½•çš„èŠå¤©ç•Œé¢ã€‚